<html>
<head>
<title>version-20220515</title>
<style>
* {
  padding: 0px;
  margin: 0px;
}
body {
  background-color: #33336f;
  color: #debf35;
  font-family: monospace;
  font-size: 2.8vmin;
}
div#note-console {
  background-color: #ddddff;
  color: #333333;
  height: 500px;
  width: 100%;
  font-family: monospace; 
  border-radius: 6px;
  overflow: scroll;
  word-wrap: break-word;
  text-shadow: 2px 2px 4px #9999bb;
  font-size: 16px;
}
.notation-console-entry-number-span {
  color: #eeeeee;
  background-color: #003344;
}
</style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  </head>
  
<body>
  musicnotes version-20220515<br>
  <canvas id="canvas1"></canvas>
  <div id="note-console">
    <h3>console:</h3></div>
    
    <script>
let topMargin = 100;
let staffSpacing = 10;
let sideMargin = 30;
let stavesSpacing = 100;
let canv1 = document.getElementById("canvas1");
let ctx1 = canv1.getContext("2d");
let noteConsole = document.getElementById("note-console");
let noteConsoleEntryNumber = 0;
let accidental = "natural";
let set_key_signature = false;
let set_accidental = false;

let accidentals = [
  "double-flat",
  "flat",
  "natural",
  "sharp",
  "double-sharp"
];

let keyMap = {
  90: "c2", 88: "d2", 67: "e2", 86: "f2", 66: "g2", 78: "a2", 77: "b2",
  188: "c3", 190: "d3", 191: "e3", 65: "f3", 83: "g3", 68: "a3", 70: "b3",
  71: "c4", 72: "d4", 74: "e4", 75: "f4", 76: "g4", 186: "a4", 222: "b4",
  81: "c5", 87: "d5", 69: "e5", 82: "f5", 84: "g5", 89: "a5", 85: "b5",
  73: "c6", 79: "d6", 80: "e6", 219: "f6", 221: "g6", 220: "a6", 49: "b6",
  50: "c7", 51: "d7", 52: "e7", 53: "f7", 54: "g7", 55: "a7", 56: "b7",
  57: "c8", 48: "d8", 189: "e8", 187: "f8",
  56: "double-flat",
  57: "flat",
  48: "natural",
  189: "sharp",
  187: "double-sharp",
  13: "color-scheme"
}

consoleLog("canv1 dimensions: " + canv1.width + ", " + canv1.height + ")");

window.addEventListener('resize', resizeCanvas, false);

function resizeCanvas() {
  canv1.width = 0.95*window.innerWidth;
  canv1.height = 0.5*window.innerHeight;
  consoleLog("canv1 dimensions: " + canv1.width + ", " + canv1.height + ")");
  drawStuff();
}

resizeCanvas();

function drawStuff() {
  ctx1.fillStyle = '#223277';
  ctx1.fillRect(0,0,canv1.width, canv1.height);
  ctx1.strokeStyle = '#00ffb5';
  ctx1.strokeRect(0, 0, canv1.width, canv1.height);
  drawStaves();
}

function drawStaves() {
  for (e=0; e<3; e++) {
    for (i=0; i<5; i++) {
      let x1 = sideMargin;
      let y1 = topMargin+staffSpacing*i+stavesSpacing*e;
      let x2 = canv1.width-sideMargin;
      let y2 = y1;
      consoleLog("(e, i, x1, y1, x2, y2) = (" + e + ", " + i + ", " + x1 + ", " + y1 + ", " + x2 + ", " + y2 + ")");
      ctx1.lineWidth = 1;
      ctx1.strokeStyle = '#0077ff';
      ctx1.beginPath();
      ctx1.moveTo(x1,y1);
      ctx1.lineTo(x2,y2);
      ctx1.stroke();
    }
  }
}

window.addEventListener("keydown", function(e) {
  let kCode = e.keyCode;
  consoleLog("keydown: " + kCode);
  consoleLog(keyMap[kCode]);
  if([32, 37, 38, 39, 40].indexOf(kCode) > -1) {
    e.preventDefault();
    if (kCode == 37) { // left
      consoleLog("left");
    } else if (kCode == 38) { // up
      consoleLog("up");
    } else if (kCode == 39) { // right
      consoleLog("right");
    } else if (kCode == 40) { // down
      consoleLog("down");
    }
  }
  let kIntent = keyMap[kCode];
  if (accidentals.includes(kIntent)) {
    accidental = kIntent;
    consoleLog("accidental = " + accidental);
  } else if (keyMap[kCode] == "color-scheme") {
    colorSchemeCycle();
  } else {
    makeNote(keyMap[(e.keyCode).toString()], accidental);
  }  
}, false);

function colorSchemeCycle() {
  console.log("cycling color scheme");
  if (color_scheme == "parchment") {
    color_scheme = "dark mode";
  } else if (color_scheme == "dark mode") {
    color_scheme = "printer";
  } else if (color_scheme == "printer") {
    color_scheme = "parchment";
  }
  colorSchemeSet();
  printSequence();
}

function colorSchemeSet() {
  for (i=0; i<color_schemes.length; i++) {
    if (color_schemes[i].name == color_scheme) {
      ink = color_schemes[i].ink;
      parchment = color_schemes[i].parchment;
      selected = color_schemes[i].selected;
    }
  }    
}

function makeNote(noteName, accidental_setting) {
  if (set_key_signature == true) {
    let key_name = noteName.slice(0,1)+accidental_setting;
    console.log(key_name);
    key_signature = key_signatures[key_name];
    printSequence();
    set_key_signature = false;
  } else {
    setAccidental(accidental_setting);
    let name = noteName.slice(0, 1);
    let octave = noteName.slice(1, 2);
    let note = new MusicNote(name, octave, accidental);
    notes_sequence1.push(note);
    consoleLog(noteName + " " + note.accidental + " pushed to notes_sequence1");
    printSequence();
  }
}

function consoleLog(consoleEntry) {
  noteConsoleEntryNumber ++;
  let lineBreak = document.createElement("BR");
  let entryNumberSpan = document.createElement("SPAN");
  let entryNumber = document.createTextNode(noteConsoleEntryNumber + ": ");
  let entry = document.createTextNode(consoleEntry);
  entryNumberSpan.class = "notation-console-entry-number-span";
  entryNumberSpan.appendChild(entryNumber);
  noteConsole.appendChild(lineBreak);
  noteConsole.appendChild(entryNumberSpan);
  noteConsole.appendChild(entry);
  noteConsole.scrollTop = noteConsole.scrollHeight;
}

</script>


<div class="output"></div>
<script language="javascript">
  var realConsoleLog = console.log;
  console.log = function () {
    var message = [].join.call(arguments, " ");
    $(".output").text(message);
    realConsoleLog.apply(console, arguments);
  };
  console.log("hello", "my", "name", "is", "shantharuban");
</script>

</body>
</html>

























