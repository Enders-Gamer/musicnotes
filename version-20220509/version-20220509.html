<html>
<style>
    * {
        padding: 0;
        margin: 0;
    }
    button.accidental {
        width:70;
        height:40;
        margin: -2px;
    }
    button.note-key {
        width: 20;
        height: 80;
        margin: -2px;
        font-size: 11px;
    }
    .notation-console-entry-number-span {
        color: #eeeeee;
        background-color: #003344;
    }
    div#note-console {
        height: 200px;
        width: 100%;
        background-color: #ddeeff;
        font-family: monospace;
    }
</style>
</head>
<body>
  
  <canvas id="canvas1"></canvas>
<br>
  <td><button class="note-key" id="c3button" onclick="makeNote('c3');">C3</button></td>
  <td><button class="note-key" id="d3button" onclick="makeNote('d3');">D3</button></td>
  <td><button class="note-key" id="e3button" onclick="makeNote('e3');">E3</button></td>
  <td><button class="note-key" id="f3button" onclick="makeNote('f3');">F3</button></td>
  <td><button class="note-key" id="g3button" onclick="makeNote('g3');">G3</button></td>
  <td><button class="note-key" id="a3button" onclick="makeNote('a3');">A3</button></td>
  <td><button class="note-key" id="b3button" onclick="makeNote('b3');">B3</button></td>
  
  <td><button class="note-key" id="c4button" onclick="makeNote('c4');">C4</button></td>
  <td><button class="note-key" id="d4button" onclick="makeNote('d4');">D4</button></td>
  <td><button class="note-key" id="e4button" onclick="makeNote('e4');">E4</button></td>
  <td><button class="note-key" id="f4button" onclick="makeNote('f4');">F4</button></td>
  <td><button class="note-key" id="g4button" onclick="makeNote('g4');">G4</button></td>
  <td><button class="note-key" id="a4button" onclick="makeNote('a4');">A4</button></td>
  <td><button class="note-key" id="b4button" onclick="makeNote('b4');">B4</button></td>
  
  <td><button class="note-key" id="c5button" onclick="makeNote('c5');">C5</button></td>
  <td><button class="note-key" id="d5button" onclick="makeNote('d5');">D5</button></td>
  <td><button class="note-key" id="e5button" onclick="makeNote('e5');">E5</button></td>
  <td><button class="note-key" id="f5button" onclick="makeNote('f5');">F5</button></td>
  <td><button class="note-key" id="g5button" onclick="makeNote('g5');">G5</button></td>
  <td><button class="note-key" id="a5button" onclick="makeNote('a5');">A5</button></td>
  <td><button class="note-key" id="b5button" onclick="makeNote('b5');">B5</button></td>
  
  <td><button class="note-key" id="c6button" onclick="makeNote('c6');">C6</button></td>
  <td><button class="note-key" id="d6button" onclick="makeNote('d6');">D6</button></td>
  <td><button class="note-key" id="e6button" onclick="makeNote('e6');">E6</button></td>
  <td><button class="note-key" id="f6button" onclick="makeNote('f6');">F6</button></td>
  <td><button class="note-key" id="g6button" onclick="makeNote('g6');">G6</button></td>
  <td><button class="note-key" id="a6button" onclick="makeNote('a6');">A6</button></td>
  <td><button class="note-key" id="b6button" onclick="makeNote('b6');">B6</button></td>
<br>
  <td><button class="accidental" onclick="setAccidental(this.id)" data-id="-2" id="double-flat">bb</button></td>
  <td><button class="accidental" onclick="setAccidental(this.id)" data-id="-1" id="flat">b</button></td>
  <td><button class="accidental" onclick="setAccidental(this.id)" data-id="0"  id="natural" class="selected">natural</button></td>
  <td><button class="accidental" onclick="setAccidental(this.id)" data-id="1"  id="sharp">#</button></td>
  <td><button class="accidental" onclick="setAccidental(this.id)" data-id="2"  id="double-sharp">##</button></td>
<br>
  <div id="note-console"></div>

<script>
  
  class MusicNote {
    constructor(name, octave, accidental) {
          this.name = name;
          this.octave = octave;
          this.accidental = accidental;
        }
      }

  let staff_spacing = 10;
  let note_spacing = 30;
  let top_margin = 30;
  let notes_sequence1 = [];
  let note_head_radius = staff_spacing*0.5;
  let line_thickness = 1;
  let thick_line_thickness = 2.5;
  let xStart = 30;
  let side_margin = 10;
  let staves_quantity = 12;
  let staves_spacing = 100;
  let canv1 = document.getElementById("canvas1");
  let ctx1 = canv1.getContext("2d");
  let noteConsole = document.getElementById("note-console");
  let noteConsoleEntryNumber = 0;
  let ledger_line_radius = 8;
  let accidental = "natural";
  let accidental_x_offset = 2*note_head_radius;
  
  canv1.width = 600;
  canv1.height = 400;
  
  clearPage();
  drawStaves();
  
  let y_values = {
    b6: -7, a6: -6.5, g6: -6, f6: -5.5, e6: -5, d6: -4.5, c6: -4,
    b5: -3.5, a5: -3, g5: -2.5, f5: -2, e5: -1.5, d5: -1, c5: -0.5,
    b4: 0.0, a4: 0.5, g4: 1.0, f4: 1.5, e4: 2.0, d4: 2.5, c4: 3.0,
    b3: 3.5, a3: 4.0, g3: 4.5, f3: 5.0, e3: 5.5, d3: 6.0, c3: 6.5
  }
  
  function clearPage() {
    ctx1.fillStyle = "#eeffbb";
    ctx1.fillRect(0,0,canv1.width, canv1.height);
    ctx1.strokeStyle = "#000000";
    ctx1.strokeRect(0, 0, canv1.width, canv1.height);
  }

  function makeNote(noteName) {
    let name = noteName.slice(0, 1);
    let octave = noteName.slice(1, 2);
    let note = new MusicNote(name, octave, accidental);
    notes_sequence1.push(note);
    consoleLog(noteName + " " + note.accidental + " pushed to notes_sequence1");
    printSequence();
  }
  
  function printSequence() {
    clearPage();
    drawStaves();
    let e = 0;
    let x = xStart;
    for (ii=0; ii<notes_sequence1.length; ii++) {
      if (x+15>canv1.width-side_margin) {
        x=xStart;
        e+=1;
      }
      let noteName = notes_sequence1[ii].name+notes_sequence1[ii].octave;
      let y = top_margin + 2*staff_spacing + y_values[noteName]*staff_spacing + staves_spacing*e;
      drawNoteHead(x, y);
      if (notes_sequence1[ii].accidental == "double-flat") {
        drawDoubleFlat(x, y);
      } else if (notes_sequence1[ii].accidental == "flat") {
        drawFlat(x, y);
      } else if (notes_sequence1[ii].accidental == "natural") {
        drawNatural(x, y);
      } else if (notes_sequence1[ii].accidental == "sharp") {
        drawSharp(x, y);
      } else if (notes_sequence1[ii].accidental == "double-sharp") {
        drawDoubleSharp(x, y);
      }
      x += note_spacing;
    }
  }
  
  function drawNoteHead(x,y){
    ctx1.strokeStyle = "#000000";
    ctx1.fillStyle = "#000000";
    ctx1.beginPath();
    ctx1.ellipse(x, y, 6/2, 8/2, Math.PI / 3, 0, 2 * Math.PI);
    ctx1.fill();
  }
  
  function drawStaves() {
    for(e=0;e<staves_quantity;e++){
      for(i=0;i<5;i++){
      let x1 = side_margin;
      let y1 = top_margin+10*i+staves_spacing*e;
      let x2 = canv1.width-side_margin;
      let y2 = top_margin+10*i+staves_spacing*e;
      drawLine(x1, y1, x2, y2);
    }
  }
}

function drawLine(x1,y1,x2,y2){
  ctx1.lineWidth = line_thickness;
  ctx1.beginPath();
  ctx1.moveTo( x1, y1 );
  ctx1.lineTo( x2, y2 );
  ctx1.stroke();
}

function consoleLog(consoleEntry) {
    noteConsoleEntryNumber ++;
    let lineBreak = document.createElement("BR");
    let entryNumberSpan = document.createElement("SPAN");
    let entryNumber = document.createTextNode(noteConsoleEntryNumber + ": ");
    let entry = document.createTextNode(consoleEntry);
    entryNumberSpan.class = "notation-console-entry-number-span";
    entryNumberSpan.appendChild(entryNumber);
    noteConsole.appendChild(lineBreak);
    noteConsole.appendChild(entryNumberSpan);
    noteConsole.appendChild(entry);
    noteConsole.scrollTop = noteConsole.scrollHeight;
}

function setAccidental(value) {
  accidental = value;
}

function drawFlat(x,y){
    //drawReticle (x,y);
    let x1 = x-1-accidental_x_offset;
    let y1 = y-13;
    let x2 = x-3-accidental_x_offset;
    let y2 = y+4;
    let x3 = x+5-accidental_x_offset;
    let y3 = y+1;
    let x4 = x+5-accidental_x_offset;
    let y4 = y-5;
    let x5 = x-3-accidental_x_offset;
    let y5 = y-1;
    let x6 = x+5-accidental_x_offset;
    let y6 = y-5;
    let x7 = x+5-accidental_x_offset;
    let y7 = y+1;
    let x8 = x-3-accidental_x_offset;
    let y8 = y+4;
    ctx1.beginPath();
    ctx1.moveTo(x1, y1);
    ctx1.lineTo(x2, y2);
    ctx1.bezierCurveTo(x3,y3, x4,y4, x5,y5);
    ctx1.bezierCurveTo(x6,y6, x7,y7, x8,y8);
    ctx1.stroke();

    // ctx.moveTo(x-1,y-13);
    // ctx.lineTo(x-3,y+4);
    // ctx.bezierCurveTo( x+5,y+1, x+5,y-5, x-3,y-1   );
    // ctx.bezierCurveTo( x+5,y-5, x+5,y+1, x-3,y+4   );
}

function drawDoubleFlat(x,y){
    //drawReticle(x,y);
    let x1 = x+3-accidental_x_offset;
    let y1 = y;
    let x2 = x+8-accidental_x_offset;
    let y2 = y;
    drawFlat(x1,y1);
    drawFlat(x2,y2);
}

function drawNatural(x,y){
    //drawReticle(x,y);
    let x1 = x-2-accidental_x_offset;
    let y1 = y-8;
    let x2 = x-2-accidental_x_offset;
    let y2 = y+5;
    let x3 = x-2-accidental_x_offset;
    let y3 = y+0;
    let x4 = x+2-accidental_x_offset;
    let y4 = y-5;
    let x5 = x-2-accidental_x_offset;
    let y5 = y+5;
    let x6 = x+2-accidental_x_offset;
    let y6 = y-0;
    let x7 = x+2-accidental_x_offset;
    let y7 = y-5;
    let x8 = x+2-accidental_x_offset;
    let y8 = y+8;
    drawLine(x1,y1,x2,y2);
    drawLine(x3,y3,x4,y4);
    drawLine(x5,y5,x6,y6);
    drawLine(x7,y7,x8,y8);
    // drawLine(x-2,y-8,x-2,y+5);
    // drawLine(x-2,y+0,x+2,y-5);
    // drawLine(x-2,y+5,x+2,y-0);
    // drawLine(x+2,y-5,x+2,y+8);
}

function drawSharp(x,y){
    //drawReticle(x,y);
    let x1 = x-4-accidental_x_offset;
    let y1 = y+7;
    ctx1.font = "18px arial"
    ctx1.fillText("#",x1,y1);
}

function drawDoubleSharp(x,y){
    //drawReticle(x,y);
    let x1 = x-4-accidental_x_offset;
    let y1 = y+5;
    ctx1.font = "16px arial"
    ctx1.fillText("x",x1,y1);
}



</script>
</html>
